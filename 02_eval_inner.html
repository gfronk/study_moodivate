<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gaylen Fronk">

<title>Analysis Workflow Step 2: Inner Loop Model Selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02_eval_inner_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_eval_inner_files/libs/quarto-html/quarto.js"></script>
<script src="02_eval_inner_files/libs/quarto-html/popper.min.js"></script>
<script src="02_eval_inner_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_eval_inner_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_eval_inner_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_eval_inner_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_eval_inner_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_eval_inner_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_eval_inner_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis Workflow Step 2: Inner Loop Model Selection</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gaylen Fronk </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Load libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Source functions file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"fun_moodivate.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This functions file (fun_moodivate.R) contains many functions that are used throughout the Moodivate project analysis scripts. Functions split data, fit and evaluate models, and provide helper functionality for the modeling process. See all annotated code building functions within fun_moodivate.R.</p>
</section>
<section id="read-in-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-data">Read in data</h2>
<p>Read in results file (“results.csv”) created in 01_fit_inner.qmd. This file contains one row per model configuration (unique combination of model tuning parameters and feature set) for each held-out fold. Each row contains the model configuration information (outer split number, inner split number, feature set, hp1 [alpha/mixture], and hp2 [lambda/penalty]). Each row also contains performance metrics for the model fit in the held-in data and evaluated in the indicated validation set (held-out fold from inner loop).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cv_resample_type <span class="ot">&lt;-</span> <span class="st">"nested"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"~/Desktop/internship/moodivate/results_"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                      cv_resample_type, <span class="st">".csv"</span>), </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>Rows: 990,000
Columns: 13
$ config_num      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ outer_split_num &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ inner_split_num &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ feature_set     &lt;chr&gt; "thru_wk2", "thru_wk2", "thru_wk2", "thru_wk2", "thru_…
$ hp1             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ hp2             &lt;dbl&gt; 0.0003354626, 0.0003711182, 0.0004105636, 0.0004542015…
$ accuracy        &lt;dbl&gt; 0.516129, 0.516129, 0.516129, 0.516129, 0.516129, 0.51…
$ sens            &lt;dbl&gt; 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4,…
$ spec            &lt;dbl&gt; 0.625, 0.625, 0.625, 0.625, 0.625, 0.625, 0.625, 0.625…
$ ppv             &lt;dbl&gt; 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,…
$ npv             &lt;dbl&gt; 0.5263158, 0.5263158, 0.5263158, 0.5263158, 0.5263158,…
$ roc_auc         &lt;dbl&gt; 0.4208333, 0.4208333, 0.4208333, 0.4208333, 0.4208333,…
$ new_config_num  &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…</code></pre>
</div>
</div>
</section>
<section id="process-metrics" class="level2">
<h2 class="anchored" data-anchor-id="process-metrics">Process metrics</h2>
<p>Check for duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>[1] 990000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(outer_split_num, inner_split_num, feature_set, hp1, hp2,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>[1] 990000</code></pre>
</div>
</div>
<p>No duplicates</p>
<p>Checks that breakdowns are as expected. Should be equal numbers of each value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(outer_split_num) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code> outer_split_num     n    percent
               1 33000 0.03333333
               2 33000 0.03333333
               3 33000 0.03333333
               4 33000 0.03333333
               5 33000 0.03333333
               6 33000 0.03333333
               7 33000 0.03333333
               8 33000 0.03333333
               9 33000 0.03333333
              10 33000 0.03333333
              11 33000 0.03333333
              12 33000 0.03333333
              13 33000 0.03333333
              14 33000 0.03333333
              15 33000 0.03333333
              16 33000 0.03333333
              17 33000 0.03333333
              18 33000 0.03333333
              19 33000 0.03333333
              20 33000 0.03333333
              21 33000 0.03333333
              22 33000 0.03333333
              23 33000 0.03333333
              24 33000 0.03333333
              25 33000 0.03333333
              26 33000 0.03333333
              27 33000 0.03333333
              28 33000 0.03333333
              29 33000 0.03333333
              30 33000 0.03333333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(inner_split_num) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code> inner_split_num     n percent
               1 99000     0.1
               2 99000     0.1
               3 99000     0.1
               4 99000     0.1
               5 99000     0.1
               6 99000     0.1
               7 99000     0.1
               8 99000     0.1
               9 99000     0.1
              10 99000     0.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(hp1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code> hp1     n    percent
 0.0 90000 0.09090909
 0.1 90000 0.09090909
 0.2 90000 0.09090909
 0.3 90000 0.09090909
 0.4 90000 0.09090909
 0.5 90000 0.09090909
 0.6 90000 0.09090909
 0.7 90000 0.09090909
 0.8 90000 0.09090909
 0.9 90000 0.09090909
 1.0 90000 0.09090909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(hp2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>          hp2    n percent
 0.0003354626 9900    0.01
 0.0003711182 9900    0.01
 0.0004105636 9900    0.01
 0.0004542015 9900    0.01
 0.0005024775 9900    0.01
 0.0005558848 9900    0.01
 0.0006149686 9900    0.01
 0.0006803322 9900    0.01
 0.0007526433 9900    0.01
 0.0008326401 9900    0.01
 0.0009211396 9900    0.01
 0.0010190450 9900    0.01
 0.0011273580 9900    0.01
 0.0012471820 9900    0.01
 0.0013797420 9900    0.01
 0.0015263920 9900    0.01
 0.0016886290 9900    0.01
 0.0018681100 9900    0.01
 0.0020666670 9900    0.01
 0.0022863280 9900    0.01
 0.0025293370 9900    0.01
 0.0027981750 9900    0.01
 0.0030955870 9900    0.01
 0.0034246100 9900    0.01
 0.0037886040 9900    0.01
 0.0041912870 9900    0.01
 0.0046367700 9900    0.01
 0.0051296020 9900    0.01
 0.0056748160 9900    0.01
 0.0062779800 9900    0.01
 0.0069452520 9900    0.01
 0.0076834480 9900    0.01
 0.0085001050 9900    0.01
 0.0094035630 9900    0.01
 0.0104030467 9900    0.01
 0.0115087638 9900    0.01
 0.0127320052 9900    0.01
 0.0140852622 9900    0.01
 0.0155823540 9900    0.01
 0.0172385683 9900    0.01
 0.0190708181 9900    0.01
 0.0210978137 9900    0.01
 0.0233402543 9900    0.01
 0.0258210389 9900    0.01
 0.0285655008 9900    0.01
 0.0316016655 9900    0.01
 0.0349605380 9900    0.01
 0.0386764167 9900    0.01
 0.0427872490 9900    0.01
 0.0473350120 9900    0.01
 0.0523661470 9900    0.01
 0.0579320302 9900    0.01
 0.0640894990 9900    0.01
 0.0709014320 9900    0.01
 0.0784373910 9900    0.01
 0.0867743290 9900    0.01
 0.0959973830 9900    0.01
 0.1062007357 9900    0.01
 0.1174885800 9900    0.01
 0.1299761846 9900    0.01
 0.1437910695 9900    0.01
 0.1590743083 9900    0.01
 0.1759819691 9900    0.01
 0.1946867083 9900    0.01
 0.2153795334 9900    0.01
 0.2382717537 9900    0.01
 0.2635971381 9900    0.01
 0.2916143020 9900    0.01
 0.3226093497 9900    0.01
 0.3568987930 9900    0.01
 0.3948327864 9900    0.01
 0.4367987011 9900    0.01
 0.4832250812 9900    0.01
 0.5345860199 9900    0.01
 0.5914060006 9900    0.01
 0.6542652529 9900    0.01
 0.7238056780 9900    0.01
 0.8007374030 9900    0.01
 0.8858460329 9900    0.01
 0.9800006730 9900    0.01
 1.0841628049 9900    0.01
 1.1993961020 9900    0.01
 1.3268772946 9900    0.01
 1.4679081848 9900    0.01
 1.6239289404 9900    0.01
 1.7965328013 9900    0.01
 1.9874823497 9900    0.01
 2.1987275087 9900    0.01
 2.4324254543 9900    0.01
 2.6909626442 9900    0.01
 2.9769791875 9900    0.01
 3.2933958046 9900    0.01
 3.6434436530 9900    0.01
 4.0306973228 9900    0.01
 4.4591113395 9900    0.01
 4.9330605466 9900    0.01
 5.4573847800 9900    0.01
 6.0374382910 9900    0.01
 6.6791444232 9900    0.01
 7.3890560990 9900    0.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(feature_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code> feature_set      n   percent
    thru_wk2 330000 0.3333333
    thru_wk3 330000 0.3333333
    thru_wk4 330000 0.3333333</code></pre>
</div>
</div>
</section>
<section id="median-metrics-across-inner-folds-for-model-configurations" class="level2">
<h2 class="anchored" data-anchor-id="median-metrics-across-inner-folds-for-model-configurations">Median metrics across inner folds for model configurations</h2>
<p>This process groups by <code>outer_split_number</code>, <code>feature_set</code>, <code>hp1</code>, and <code>hp2</code> such that each group contains the 10 inner held-out folds per unique combination of outer split number, feature set, and tuning parameters. The <code>summarize()</code> function then averages model performance metrics across the 10 held-out folds (i.e., validation sets). Validation set performance will be used for <strong>model selection</strong> in script 03_fit_eval_outer.qmd.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outer_split_num, feature_set, hp1, hp2) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(accuracy, roc_auc,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                     sens, spec, ppv, npv),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                   median),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_jobs =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(n_jobs) <span class="sc">|&gt;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(roc_auc)) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="review" class="level3">
<h3 class="anchored" data-anchor-id="review">Review</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(metrics_avg<span class="sc">$</span>n_jobs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>[1] 10</code></pre>
</div>
</div>
<p>The <code>n_jobs</code> variable should always be 10 jobs (10 inner held-out folds per combination of outer split number, feature set, and tuning parameters).</p>
<p><strong>Performance: Through Week 2 Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code># A tibble: 50 × 11
   n_jobs outer_split_num feature_set   hp1   hp2 accuracy roc_auc  sens  spec
    &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     10              12 thru_wk2      0   7.39     0.541   0.585 0.467 0.733
 2     10              12 thru_wk2      0.1 0.483    0.517   0.585 0.433 0.688
 3     10              12 thru_wk2      0.1 0.535    0.525   0.585 0.433 0.688
 4     10              12 thru_wk2      0.1 0.591    0.525   0.585 0.433 0.688
 5     10              12 thru_wk2      0.1 0.654    0.525   0.585 0.433 0.688
 6     10              12 thru_wk2      0.1 0.724    0.525   0.585 0.433 0.688
 7     10              12 thru_wk2      0.1 0.801    0.525   0.585 0.433 0.688
 8     10              12 thru_wk2      0.1 0.886    0.525   0.585 0.433 0.688
 9     10              12 thru_wk2      0.1 0.980    0.525   0.585 0.433 0.688
10     10              12 thru_wk2      0.1 1.08     0.525   0.585 0.433 0.688
11     10              12 thru_wk2      0.1 1.20     0.525   0.585 0.433 0.688
12     10              12 thru_wk2      0.1 1.33     0.525   0.585 0.433 0.688
13     10              12 thru_wk2      0.1 1.47     0.525   0.585 0.433 0.688
14     10              12 thru_wk2      0.1 1.62     0.525   0.585 0.433 0.688
15     10              12 thru_wk2      0.1 1.80     0.525   0.585 0.433 0.688
16     10              12 thru_wk2      0.1 1.99     0.525   0.585 0.433 0.688
17     10              12 thru_wk2      0.1 2.20     0.525   0.585 0.433 0.688
18     10              12 thru_wk2      0.1 2.43     0.525   0.585 0.433 0.688
19     10              12 thru_wk2      0.1 2.69     0.525   0.585 0.433 0.688
20     10              12 thru_wk2      0.1 2.98     0.525   0.585 0.433 0.688
21     10              12 thru_wk2      0.1 3.29     0.525   0.585 0.433 0.688
22     10              12 thru_wk2      0.1 3.64     0.525   0.585 0.433 0.688
23     10              12 thru_wk2      0.1 4.03     0.525   0.585 0.433 0.688
24     10              12 thru_wk2      0.1 4.46     0.525   0.585 0.433 0.688
25     10              12 thru_wk2      0.1 4.93     0.525   0.585 0.433 0.688
26     10              12 thru_wk2      0.1 5.46     0.525   0.585 0.433 0.688
27     10              12 thru_wk2      0.1 6.04     0.525   0.585 0.433 0.688
28     10              12 thru_wk2      0.1 6.68     0.525   0.585 0.433 0.688
29     10              12 thru_wk2      0.1 7.39     0.525   0.585 0.433 0.688
30     10              12 thru_wk2      0.2 0.238    0.517   0.585 0.433 0.688
31     10              12 thru_wk2      0.2 0.264    0.525   0.585 0.433 0.688
32     10              12 thru_wk2      0.2 0.292    0.525   0.585 0.433 0.688
33     10              12 thru_wk2      0.2 0.323    0.525   0.585 0.433 0.688
34     10              12 thru_wk2      0.2 0.357    0.525   0.585 0.433 0.688
35     10              12 thru_wk2      0.2 0.395    0.525   0.585 0.433 0.688
36     10              12 thru_wk2      0.2 0.437    0.525   0.585 0.433 0.688
37     10              12 thru_wk2      0.2 0.483    0.525   0.585 0.433 0.688
38     10              12 thru_wk2      0.2 0.535    0.525   0.585 0.433 0.688
39     10              12 thru_wk2      0.2 0.591    0.525   0.585 0.433 0.688
40     10              12 thru_wk2      0.2 0.654    0.525   0.585 0.433 0.688
41     10              12 thru_wk2      0.2 0.724    0.525   0.585 0.433 0.688
42     10              12 thru_wk2      0.2 0.801    0.525   0.585 0.433 0.688
43     10              12 thru_wk2      0.2 0.886    0.525   0.585 0.433 0.688
44     10              12 thru_wk2      0.2 0.980    0.525   0.585 0.433 0.688
45     10              12 thru_wk2      0.2 1.08     0.525   0.585 0.433 0.688
46     10              12 thru_wk2      0.2 1.20     0.525   0.585 0.433 0.688
47     10              12 thru_wk2      0.2 1.33     0.525   0.585 0.433 0.688
48     10              12 thru_wk2      0.2 1.47     0.525   0.585 0.433 0.688
49     10              12 thru_wk2      0.2 1.62     0.525   0.585 0.433 0.688
50     10              12 thru_wk2      0.2 1.80     0.525   0.585 0.433 0.688
     ppv   npv
   &lt;dbl&gt; &lt;dbl&gt;
 1 0.547 0.535
 2 0.523 0.512
 3 0.523 0.525
 4 0.523 0.525
 5 0.523 0.525
 6 0.523 0.525
 7 0.523 0.525
 8 0.523 0.525
 9 0.523 0.525
10 0.523 0.525
11 0.523 0.525
12 0.523 0.525
13 0.523 0.525
14 0.523 0.525
15 0.523 0.525
16 0.523 0.525
17 0.523 0.525
18 0.523 0.525
19 0.523 0.525
20 0.523 0.525
21 0.523 0.525
22 0.523 0.525
23 0.523 0.525
24 0.523 0.525
25 0.523 0.525
26 0.523 0.525
27 0.523 0.525
28 0.523 0.525
29 0.523 0.525
30 0.523 0.512
31 0.523 0.525
32 0.523 0.525
33 0.523 0.525
34 0.523 0.525
35 0.523 0.525
36 0.523 0.525
37 0.523 0.525
38 0.523 0.525
39 0.523 0.525
40 0.523 0.525
41 0.523 0.525
42 0.523 0.525
43 0.523 0.525
44 0.523 0.525
45 0.523 0.525
46 0.523 0.525
47 0.523 0.525
48 0.523 0.525
49 0.523 0.525
50 0.523 0.525</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(roc_auc) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Performance: Through Week 3 Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk3"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code># A tibble: 50 × 11
   n_jobs outer_split_num feature_set   hp1     hp2 accuracy roc_auc  sens  spec
    &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     10               5 thru_wk3      0   0.0286     0.532   0.621 0.6   0.579
 2     10               5 thru_wk3      0   0.0233     0.532   0.619 0.6   0.579
 3     10               5 thru_wk3      0.1 0.0115     0.565   0.619 0.6   0.612
 4     10               5 thru_wk3      0.1 0.0127     0.548   0.619 0.6   0.612
 5     10               5 thru_wk3      0.1 0.0156     0.548   0.619 0.6   0.612
 6     10               5 thru_wk3      0.1 0.0211     0.532   0.619 0.6   0.612
 7     10               5 thru_wk3      0.2 0.00628    0.581   0.619 0.6   0.612
 8     10               5 thru_wk3      0.2 0.0156     0.548   0.619 0.567 0.625
 9     10               5 thru_wk3      0.1 0.00940    0.565   0.617 0.6   0.612
10     10               5 thru_wk3      0.1 0.0104     0.565   0.617 0.6   0.612
11     10               5 thru_wk3      0.1 0.0141     0.548   0.617 0.6   0.612
12     10               5 thru_wk3      0.1 0.0172     0.548   0.617 0.6   0.612
13     10               5 thru_wk3      0.1 0.0191     0.548   0.617 0.6   0.612
14     10               5 thru_wk3      0.1 0.0233     0.516   0.617 0.6   0.625
15     10               5 thru_wk3      0.2 0.00695    0.581   0.617 0.6   0.612
16     10               5 thru_wk3      0.2 0.00768    0.565   0.617 0.6   0.612
17     10               5 thru_wk3      0.2 0.00850    0.565   0.617 0.6   0.612
18     10               5 thru_wk3      0.2 0.0172     0.532   0.617 0.6   0.625
19     10               5 thru_wk3      0.3 0.00513    0.581   0.617 0.6   0.612
20     10               5 thru_wk3      0.3 0.00567    0.581   0.617 0.6   0.612
21     10               5 thru_wk3      0.3 0.00628    0.581   0.617 0.6   0.612
22     10               5 thru_wk3      0.3 0.0115     0.548   0.617 0.567 0.625
23     10               5 thru_wk3      1   0.00310    0.581   0.617 0.567 0.612
24     10               5 thru_wk3      0   0.0211     0.532   0.615 0.6   0.579
25     10               5 thru_wk3      0   0.0316     0.525   0.615 0.567 0.579
26     10               5 thru_wk3      0   0.0350     0.548   0.615 0.567 0.579
27     10               5 thru_wk3      0.1 0.0258     0.532   0.615 0.6   0.625
28     10               5 thru_wk3      0.2 0.00567    0.581   0.615 0.6   0.612
29     10               5 thru_wk3      0.2 0.00940    0.565   0.615 0.6   0.612
30     10               5 thru_wk3      0.2 0.0141     0.548   0.615 0.567 0.625
31     10               5 thru_wk3      0.2 0.0191     0.548   0.615 0.6   0.625
32     10               5 thru_wk3      0.2 0.0211     0.532   0.615 0.6   0.594
33     10               5 thru_wk3      0.3 0.00695    0.565   0.615 0.6   0.612
34     10               5 thru_wk3      0.3 0.00940    0.548   0.615 0.567 0.646
35     10               5 thru_wk3      0.4 0.00379    0.581   0.615 0.6   0.612
36     10               5 thru_wk3      0.4 0.00419    0.581   0.615 0.6   0.612
37     10               5 thru_wk3      0.4 0.00695    0.548   0.615 0.567 0.646
38     10               5 thru_wk3      0.4 0.00850    0.548   0.615 0.567 0.646
39     10               5 thru_wk3      0.4 0.00940    0.548   0.615 0.567 0.656
40     10               5 thru_wk3      0.5 0.00419    0.581   0.615 0.6   0.612
41     10               5 thru_wk3      0.5 0.00850    0.565   0.615 0.567 0.625
42     10               5 thru_wk3      0.6 0.00379    0.581   0.615 0.6   0.612
43     10               5 thru_wk3      0.7 0.00695    0.548   0.615 0.567 0.594
44     10               5 thru_wk3      0.9 0.00342    0.565   0.615 0.567 0.612
45     10               5 thru_wk3      0   0.0191     0.565   0.612 0.6   0.579
46     10               5 thru_wk3      0   0.0258     0.532   0.612 0.6   0.579
47     10               5 thru_wk3      0.2 0.0115     0.548   0.612 0.6   0.625
48     10               5 thru_wk3      0.2 0.0127     0.548   0.612 0.6   0.625
49     10               5 thru_wk3      0.3 0.00419    0.581   0.612 0.6   0.612
50     10               5 thru_wk3      0.3 0.00464    0.581   0.612 0.6   0.612
     ppv   npv
   &lt;dbl&gt; &lt;dbl&gt;
 1 0.511 0.555
 2 0.511 0.555
 3 0.547 0.607
 4 0.530 0.590
 5 0.530 0.590
 6 0.511 0.569
 7 0.573 0.625
 8 0.530 0.583
 9 0.558 0.607
10 0.547 0.607
11 0.530 0.590
12 0.530 0.590
13 0.530 0.578
14 0.5   0.555
15 0.573 0.618
16 0.558 0.607
17 0.558 0.607
18 0.519 0.563
19 0.573 0.625
20 0.573 0.625
21 0.573 0.618
22 0.530 0.590
23 0.558 0.594
24 0.511 0.555
25 0.511 0.536
26 0.530 0.563
27 0.511 0.582
28 0.573 0.625
29 0.558 0.607
30 0.530 0.590
31 0.530 0.590
32 0.511 0.582
33 0.558 0.607
34 0.530 0.583
35 0.573 0.625
36 0.573 0.625
37 0.530 0.583
38 0.530 0.590
39 0.530 0.590
40 0.561 0.625
41 0.542 0.583
42 0.573 0.612
43 0.530 0.583
44 0.547 0.584
45 0.547 0.602
46 0.511 0.555
47 0.530 0.590
48 0.530 0.590
49 0.573 0.625
50 0.573 0.625</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk3"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(roc_auc) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Performance: Through Week 4 Models</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code># A tibble: 50 × 11
   n_jobs outer_split_num feature_set   hp1     hp2 accuracy roc_auc  sens  spec
    &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     10               5 thru_wk4      0.4 0.0127     0.541   0.625 0.533 0.517
 2     10               5 thru_wk4      0.5 0.0115     0.541   0.625 0.533 0.517
 3     10               5 thru_wk4      0.7 0.00850    0.558   0.625 0.567 0.517
 4     10               5 thru_wk4      1   0.00628    0.567   0.625 0.6   0.517
 5     10               5 thru_wk4      0.5 0.0104     0.541   0.623 0.533 0.517
 6     10               5 thru_wk4      0.8 0.00695    0.567   0.623 0.6   0.517
 7     10               5 thru_wk4      0.8 0.00768    0.567   0.623 0.6   0.517
 8     10               5 thru_wk4      0.9 0.00695    0.567   0.623 0.6   0.517
 9     10               5 thru_wk4      0.3 0.0156     0.541   0.621 0.533 0.517
10     10               5 thru_wk4      0.4 0.00940    0.548   0.621 0.567 0.517
11     10               5 thru_wk4      0.4 0.0115     0.541   0.621 0.533 0.517
12     10               5 thru_wk4      0.5 0.00695    0.567   0.621 0.6   0.517
13     10               5 thru_wk4      0.5 0.00850    0.558   0.621 0.567 0.517
14     10               5 thru_wk4      0.5 0.00940    0.548   0.621 0.567 0.517
15     10               5 thru_wk4      0.6 0.00628    0.567   0.621 0.6   0.517
16     10               5 thru_wk4      0.6 0.00850    0.558   0.621 0.567 0.517
17     10               5 thru_wk4      0.6 0.00940    0.541   0.621 0.533 0.517
18     10               5 thru_wk4      0.6 0.0104     0.541   0.621 0.533 0.517
19     10               5 thru_wk4      0.7 0.00567    0.567   0.621 0.6   0.517
20     10               5 thru_wk4      0.7 0.00628    0.567   0.621 0.6   0.517
21     10               5 thru_wk4      0.7 0.00695    0.567   0.621 0.6   0.517
22     10               5 thru_wk4      0.7 0.00768    0.567   0.621 0.6   0.517
23     10               5 thru_wk4      0.7 0.00940    0.574   0.621 0.567 0.517
24     10               5 thru_wk4      0.8 0.00567    0.567   0.621 0.6   0.517
25     10               5 thru_wk4      0.8 0.00850    0.574   0.621 0.567 0.517
26     10               5 thru_wk4      0.9 0.00628    0.567   0.621 0.6   0.517
27     10               5 thru_wk4      1   0.00567    0.567   0.621 0.6   0.517
28     10               5 thru_wk4      0.8 0.00940    0.574   0.619 0.567 0.533
29     10               5 thru_wk4      0.9 0.00768    0.558   0.619 0.567 0.517
30     10               5 thru_wk4      0.9 0.00850    0.574   0.619 0.567 0.533
31     10               5 thru_wk4      1   0.00695    0.574   0.619 0.633 0.517
32     10               5 thru_wk4      0.3 0.0115     0.541   0.619 0.533 0.517
33     10               5 thru_wk4      0.3 0.0141     0.541   0.619 0.533 0.517
34     10               5 thru_wk4      0.4 0.00768    0.548   0.619 0.567 0.533
35     10               5 thru_wk4      0.4 0.0104     0.541   0.619 0.533 0.517
36     10               5 thru_wk4      0.5 0.00628    0.558   0.619 0.6   0.517
37     10               5 thru_wk4      0.5 0.00768    0.567   0.619 0.6   0.517
38     10               5 thru_wk4      0.6 0.00567    0.567   0.619 0.6   0.517
39     10               5 thru_wk4      0.6 0.00695    0.567   0.619 0.6   0.517
40     10               5 thru_wk4      0.6 0.00768    0.567   0.619 0.6   0.517
41     10               5 thru_wk4      0.7 0.00513    0.567   0.619 0.6   0.517
42     10               5 thru_wk4      0.8 0.00464    0.567   0.619 0.6   0.517
43     10               5 thru_wk4      0.8 0.00513    0.567   0.619 0.6   0.5  
44     10               5 thru_wk4      0.8 0.00628    0.567   0.619 0.6   0.517
45     10               5 thru_wk4      0.9 0.00419    0.567   0.619 0.6   0.517
46     10               5 thru_wk4      0.9 0.00464    0.567   0.619 0.6   0.5  
47     10               5 thru_wk4      0.3 0.0104     0.541   0.617 0.533 0.517
48     10               5 thru_wk4      0.3 0.0127     0.541   0.617 0.533 0.517
49     10               5 thru_wk4      0.4 0.00695    0.548   0.617 0.6   0.517
50     10               5 thru_wk4      0.4 0.00850    0.541   0.617 0.533 0.517
     ppv   npv
   &lt;dbl&gt; &lt;dbl&gt;
 1 0.533 0.556
 2 0.533 0.556
 3 0.545 0.561
 4 0.551 0.571
 5 0.533 0.542
 6 0.551 0.571
 7 0.551 0.571
 8 0.551 0.571
 9 0.533 0.556
10 0.539 0.561
11 0.533 0.542
12 0.551 0.571
13 0.545 0.561
14 0.539 0.561
15 0.551 0.571
16 0.545 0.561
17 0.539 0.542
18 0.533 0.556
19 0.551 0.571
20 0.551 0.571
21 0.551 0.571
22 0.551 0.571
23 0.551 0.575
24 0.551 0.571
25 0.551 0.575
26 0.551 0.571
27 0.551 0.571
28 0.554 0.575
29 0.545 0.561
30 0.554 0.575
31 0.551 0.593
32 0.530 0.542
33 0.533 0.556
34 0.533 0.567
35 0.533 0.542
36 0.545 0.571
37 0.551 0.571
38 0.551 0.571
39 0.551 0.571
40 0.551 0.571
41 0.551 0.571
42 0.551 0.571
43 0.551 0.571
44 0.551 0.571
45 0.551 0.571
46 0.551 0.571
47 0.530 0.542
48 0.533 0.542
49 0.539 0.571
50 0.530 0.542</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature_set <span class="sc">==</span> <span class="st">"thru_wk4"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(roc_auc) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Save average metrics file (all feature sets)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(outer_split_num, feature_set, hp1, hp2) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="st">"~/Desktop/internship/moodivate/metrics_inner_avg.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plot-tuning-parameters" class="level2">
<h2 class="anchored" data-anchor-id="plot-tuning-parameters">Plot tuning parameters</h2>
<p>This plot shows performance as a function of alpha/mixture (<code>hp1</code>) and lambda/penalty (<code>hp2</code>) separately for each <code>feature_set</code>. With shuffled data, there is no real pattern of performance as a function of tuning parameters, creating odd-looking output.</p>
<p>With real data, we will confirm that the plot captures a peak (i.e., local maximum) in performance (auROC) before continuing to outer loop model fitting and evaluation. If performance is increasing toward one end of the range for either tuning parameter, we will <strong>NOT</strong> yet proceed to fitting and evaluating models in the outer loop (in 03_fit_eval_outer.qmd). First, we will add model configurations that expand the range, run those additional configurations in the inner loop, and re-evaluate model performance as a function of tuning parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>metrics_plot <span class="ot">&lt;-</span> metrics_avg <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature_set =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    feature_set <span class="sc">==</span> <span class="st">"thru_wk2"</span> <span class="sc">~</span> <span class="st">"Weeks 1 &amp; 2"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    feature_set <span class="sc">==</span> <span class="st">"thru_wk3"</span> <span class="sc">~</span> <span class="st">"Weeks 1 - 3"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    feature_set <span class="sc">==</span> <span class="st">"thru_wk4"</span> <span class="sc">~</span> <span class="st">"Weeks 1 - 4"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>feature_sets <span class="ot">&lt;-</span> <span class="fu">unique</span>(metrics_plot<span class="sc">$</span>feature_set) </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> feature_sets) {</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  results_i <span class="ot">&lt;-</span> metrics_plot <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(feature_set <span class="sc">==</span> i)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  plot_title <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">"Plotting glmnet hyperparameters for "</span>, </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                               i, <span class="st">" models"</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  plot_i <span class="ot">&lt;-</span> results_i <span class="sc">%&gt;%</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hp1 =</span> <span class="fu">factor</span>(hp1, <span class="at">ordered =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(hp2), </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> roc_auc, </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> hp1, </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> hp1)) <span class="sc">+</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"mixture (alpha)"</span>) <span class="sc">+</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> plot_title, <span class="at">x =</span> <span class="st">"penalty (lambda)"</span>, <span class="at">y =</span> <span class="st">"auROC"</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plot_i)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_eval_inner_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>